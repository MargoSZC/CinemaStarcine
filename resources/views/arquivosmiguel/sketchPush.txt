#include <ESP8266WiFi.h>
#include <WiFiClient.h> 
#include <ESP8266WebServer.h>
#include <ESP8266HTTPClient.h>

const char *ssid = "TP-Link_688A";
const char *password = "debarbamiguel";
const int http_port = 8080;
int Luz = 0;

WiFiClient client;

void setup() {
  pinMode(D1,INPUT);

  delay(1000);
  Serial.begin(115200);
  WiFi.mode(WIFI_OFF);delay(1000);
  WiFi.mode(WIFI_STA);
  WiFi.begin(ssid, password);Serial.println(".");
  Serial.print("Conectando...");
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);Serial.print(".");}
    Serial.println ("");
    Serial.print ("Conectado a ");Serial.println (ssid);
    Serial.print (" endereço IP: ");Serial.println (WiFi.localIP ());
    Serial.print("MAC: ");
    Serial.println(WiFi.macAddress());    
}
void loop() {
  HTTPClient http;
  int Sensor=0;
  if(digitalRead(D1)==1)  
  {
    Serial.println("Botão acionado!");
    Sensor=1;
    int Luz=analogRead(0);

    String Mac=WiFi.macAddress();    
    String postData = "SSensor="+String(Sensor)+"&MMac="+String(Mac)+"&LLuz="+String(Luz);    
    http.begin(client,"http://trabalhofinal.migueldebarba.com.br/LeMa/piloto_insert.php");
    http.addHeader("Content-Type", "application/x-www-form-urlencoded");
    int httpCode = http.POST(postData);
    String payload = http.getString();
    Serial.println(httpCode);
    Serial.println(payload);
    http.end();
  }
  delay(500);
}
